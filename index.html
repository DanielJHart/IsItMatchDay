<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Is It Match Day?</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            padding: 20px;
            align-items: center;
            justify-content: center;
            background: rgb(43, 43, 43);
        }

        h1 {
            font-size: 10rem;
            color: white;
            text-align: center;
        }
        h2 {
            font-size: 2rem;
            color: white;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="result">Checking...</h1>
        <h2 id="match"></h2>
    </div>

    <script>
        const NEWCASTLE_TEAM_ID = '134777';
        const API_BASE = 'https://www.thesportsdb.com/api/v1/json/3';

        async function checkMatchDay() 
        {
            try {
                // Get next 15 events for Newcastle
                const response = await fetch(`https://www.thesportsdb.com/api/v1/json/123/eventsnext.php?id=${NEWCASTLE_TEAM_ID}`);
                
                if (!response.ok) {
                    throw new Error('Failed to fetch match data');
                }

                const data = await response.json();
                
                if (!data.events || data.events.length === 0) {
                    displayNotMatchDay();
                    return;
                }

                // Get today's date in YYYY-MM-DD format
                const today = new Date();
                const todayStr = today.toISOString().split('T')[0];

                // Check if any match is today
                const todayMatch = data.events.find(event => event.dateEvent === todayStr);

                if (todayMatch) {
                    displayMatchDay(todayMatch);
                } else {
                    displayNotMatchDay(data.events[0]);
                }

            } 
            catch (error) {
                resultDiv.innerHTML = `<strong>Error:</strong> ${error.message}<br>Unable to check match status. Please try again.`;
            }
        }

        function displayMatchDay(match) {
            const resultDiv = document.getElementById('result');
            const matchDiv = document.getElementById('match');
            
            // Determine if home or away
            const isHome = match.idHomeTeam === NEWCASTLE_TEAM_ID;
            const newcastle = isHome? match.strHomeTeam : match.strAwayTeam;
            const opponent = isHome ? match.strAwayTeam : match.strHomeTeam;
            const venue = isHome ? 'Home' : 'Away';
            
            // Format time (strTime is in HH:MM:SS format)
            let matchTime = 'TBD';
            if (match.strTime) {
                const timeParts = match.strTime.split(':');
                matchTime = `${timeParts[0]}:${timeParts[1]}`;
            } else if (match.strTimestamp) {
                const date = new Date(match.strTimestamp);
                matchTime = date.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
            }

            resultDiv.innerHTML='YES';
            matchDiv.innerHTML=`${newcastle} vs ${opponent}<br>Playing ${venue} at ${matchTime}`;
        }

        function displayNotMatchDay(nextMatch) {
            const resultDiv = document.getElementById('result');
            const matchDiv = document.getElementById('match');

            const date = new Date(nextMatch.dateEvent);
            const options = {weekday: "long", year: "numeric", month: "long", day: "numeric"};
            
            resultDiv.innerHTML = 'NO'
            matchDiv.innerHTML = `Next Match: ${date.toLocaleDateString('en-GB', options)}`;
        }

        // Check on page load
        checkMatchDay();
    </script>
</body>
</html>